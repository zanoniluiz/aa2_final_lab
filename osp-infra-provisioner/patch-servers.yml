---
- name: Manage OpenStack Servers
  hosts: control_node
  gather_facts: false
  become: false
  collections:
    - gpte.openstack

  roles:

    - openstack_manage_inmemory_inventory

- name: update resolve.conf
  hosts: load_balancers,backend_servers,database_servers
  gather_facts: false
  become: true

#    - name: Insert DNS IP
#      command: >-
#        nmcli connection modify "System eth0"
#        ipv4.ignore-auto-dns yes
#        ipv4.dns 192.168.50.62
#        +ipv4.dns 150.239.20.111
#        ipv4.dns {{ ansible_default_ipv4.address }}
#        +ipv4.dns {{ ansible_dns.nameservers.0 }}
#        +ipv4.dns 8.8.8.8
    
  handlers:
    - name: restart networkmanager
      ansible.builtin.systemd:
        name: NetworkManager
        state: restarted

  tasks:
    - name: Get control node network settings
      ansible.builtin.setup:
        filter: ansible_default_ipv4
      delegate_facts: true
      delegate_to: control
      register: result
      
    - name: debug result
      debug:
        var: result

        
#    - name: Set DNS using nmcli
#      ansible.builtin.command:
#        cmd: >-
#          nmcli connection modify "System eth0"
#          ipv4.ignore-auto-dns yes
#          ipv4.dns {{ hostvars.control.ansible_default_ipv4.address }}
#          ipv4.dns-search {{ domain }}
#      notify: restart networkmanager
